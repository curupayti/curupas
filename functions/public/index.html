<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CRUD Firebase</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="css/vendor/font-awesome.min.css">
    <link rel="stylesheet" href="css/vendor/bootstrap.min.css">
    <link rel="stylesheet" href="css/style_post.css">
    <link rel="icon" type="image/x-icon" href="https://vigil.com.ar/favicons/curupa.ico" />

  </head>
  <body>
    
     <!-- NavBar -->
     <nav class="navbar navbar-toggleable-md navbar-light bg-faded">            
        <a class="navbar-brand" href="index.html">Curupas</a>
        <ul class="nav navbar-nav mr-auto">            
            <li class="nav-item">
                <a class="nav-link" href="post.html">Posts</a>
            </li>            
            <li class="nav-item">
                    <a class="nav-link" href="#">Notificaciones</a>
            </li>
            <li class="nav-item">
                    <a class="nav-link" href="calendar.html">Calendario</a>
            </li>
        </ul>
        <ul class="nav navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="login.html">Ingresar</a>
            </li>
        </ul>         
    </nav>

    <div class="container">

    <form id="new_entry">
      <h2>Titulo App</h2>
      <br>
      <input type="text" id="title" class="form-control col-md-12" required>      
      <br>
      <br>      
      <h2>Frase bienvenida</h2>
      <br>
      <textarea name="content" id="content"></textarea>      
      <br>
      <br>      
      <div class="text-right">
          <button class="btn btn-large btn-primary">Actualizar</button>
      </div>
  </form>
</div>  

  <script src="js/vendor/jquery.min.js"></script>
  <script src="js/vendor/bootstrap.min.js"></script>    

  <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-storage.js"></script>
  
  <script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-auth.js"></script>

  <script src="https://cdn.ckeditor.com/4.5.10/standard/ckeditor.js"></script>
  
  <script>		
  
      var firebaseConfig = {
          apiKey: "AIzaSyCNW0DWuH4U-4Fa8IQLNiZc5Fxlvov0G_Y",
          authDomain: "curupas-backen.firebaseapp.com",
          databaseURL: "https://curupas-backen.firebaseio.com",
          projectId: "curupas-backen",
          storageBucket: "curupas-backen.appspot.com",
          messagingSenderId: "464846058000",
          appId: "1:464846058000:web:f1c764fb76fcc6455e5095",
          measurementId: "G-PBMTQWBJ6X"
      }; 
      firebase.initializeApp(firebaseConfig);  

      /*firebase.auth().onAuthStateChanged(function (user) {
          if (!user) {
              window.location.href = 'login.html';
          } 
      });*/

      const db = firebase.firestore();
      const storage = firebase.storage();

      var exist = false;

      $(document).ready(function () {
        db.collection("titles").doc("home")
          .onSnapshot(function(doc) {          
            exist = true;
            console.log("Document data:", doc.data());
            $("#title").val(doc.data().title);
            $("#content").text(doc.data().description);          
        });

        $('#new_entry').submit(function(e){
          e.preventDefault();        
          var now = firebase.firestore.FieldValue.serverTimestamp();
          var title = {
            title: $('#title').val(), //$(this).find('[name="title"]').val(),
            description: $("#content").val(),            
            updatedAt: now
            //updatedBy : user.name
          };
          var titlesColl =  db.collection("titles").doc("home").set(title);                    
          return false;
      });
  });

  </script>
  

  </body>
</html>
