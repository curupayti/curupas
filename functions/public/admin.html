<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CRUD Firebase</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="css/vendor/font-awesome.min.css">
    <link rel="stylesheet" href="css/vendor/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/style_index.css">
    <link rel="icon" type="image/x-icon" href="https://vigil.com.ar/favicons/curupa.ico" />    
  </head>

  <body>
           
    <header></header>

    <main role="main" class="flex-shrink-0" id="main">
      <div class="container">            
          <div class="row">
              <span class="col-4 border rounded bg-light ">
                <form id="titleForm" class="form-title p-5">
                  <h2>Titulo App</h2>
                  <br>
                  <input type="text" id="title" class="form-control" required>      
                  <br>
                  <br>      
                  <h2>Frase bienvenida</h2>
                  <br>
                  <textarea name="content" id="content" required></textarea>      
                  <br>
                  <br>      
                  <div class="text-right">
                      <button id="updateButton" class="btn btn-large btn-primary" data-toggle="modal" data-target="#editTitleModal">Actualizar</button>
                  </div>
              </form>
            </span> 
            <div class="col-4">
                <span class="border rounded">
                <div class="pt-2 pl-5" >
                  <h2 style="color:gray;">Home</h2>
                    <p style="color:gray;">El <b>título</b> y la <b>frase</b>, podes modificar ámbos.<br>Para agregar posts de imagenes ir a Posts. </p>
                    <p><a class="btn btn-secondary" href="post.html" role="button">Ir a Posts &raquo;</a></p>
                    <!--<p style="color:gray;">Para agregar imágenes al museo ir a Museo. </p>
                    <p><a class="btn btn-secondary" href="post.html" role="button">Ir a Museo &raquo;</a></p>-->
                    <p style="color:gray;">Para crear eventos en el calendario ir a Calendario. </p>
                    <p><a class="btn btn-secondary" href="post.html" role="button">Ir a Calendario &raquo;</a></p>
                  </div>
                </span>
            </div>            
            <div class="col-4" align="center">
                <img id="escudo" src="images/escudo.png" />
                <p style="color:lightgray;">Sistema de administración de la aplicación de camadas. Desarrollado para la gestión de contenido.</p>
            </div>          
          </div>          
          
          <div id="editTitleModal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <form id="delete-post-form">
                  <div class="modal-header">
                    <h4 class="modal-title">Editar Titulos App</h4>                
                  </div>
                  <div class="modal-body">
                    <p>¿Estas seguro que queres actualizar los titulos de la home de la APP?</p>
                    <p class="text-warning"><small>Esta accion no puede ser vualta atras.</small></p>
                  </div>
                  <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancelar">
                    <input id="submitTittle" type="submit" class="btn btn-danger" value="Si, actualizar">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div><!--Container-->
      </main>
      
    <footer></footer>

    <script src="js/html_loader.js"></script>

    <script src="js/vendor/jquery.min.js"></script>
    <script src="js/vendor/bootstrap.min.js"></script>    

    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-storage.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-auth.js"></script>

    <script src="https://cdn.ckeditor.com/4.5.10/standard/ckeditor.js"></script>
    
    <script>	

        var firebaseConfig = {
            apiKey: "AIzaSyCNW0DWuH4U-4Fa8IQLNiZc5Fxlvov0G_Y",
            authDomain: "curupas-backen.firebaseapp.com",
            databaseURL: "https://curupas-backen.firebaseio.com",
            projectId: "curupas-backen",
            storageBucket: "curupas-backen.appspot.com",
            messagingSenderId: "464846058000",
            appId: "1:464846058000:web:f1c764fb76fcc6455e5095",
            measurementId: "G-PBMTQWBJ6X"
        }; 
        firebase.initializeApp(firebaseConfig);  

        firebase.auth().onAuthStateChanged(function (user) {
            if (!user) {
                window.location.href = 'login.html';
            } 
        });

        const db = firebase.firestore();
        const storage = firebase.storage();

        var exist = false;

        $(document).ready(function () {          

          

          db.collection("titles").doc("home")
            .onSnapshot(function(doc) {          
              exist = true;
              console.log("Document data:", doc.data());
              $("#title").val(doc.data().title);
              $("#content").text(doc.data().description);          
          });

          $("#updateButton").on("click", function(e) {
            e.preventDefault();   
          });

          $("#submitTittle").on("click", function(e) {      
            e.preventDefault();        
            var now = firebase.firestore.FieldValue.serverTimestamp();
            var title = {
              title: $('#title').val(), 
              description: $("#content").val(),            
              updatedAt: now
              //updatedBy : user.name
            };
            db.collection("titles").doc("home").set(title).then(()=>{        
              $('#editTitleModal').modal('hide');
            });

            return false;
          });

        });

    </script>  

  </body>

</html>
